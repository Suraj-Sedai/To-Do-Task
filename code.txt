<?php
// Database connection
$host = "localhost";
$dbname = "Event_database";
$username = "surajsedai";
$password = "password";

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // Retrieve blog posts from database
    $stmt = $pdo->query("SELECT * FROM blog_posts");
    $posts = $stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    die("Error: " . $e->getMessage());
}

// Delete task================================================================
if (isset($_GET["delete"])) {
    $delete_index = $_GET["delete"];
    unset($_SESSION['blog_posts'][$delete_index]);
    $_SESSION['blog_posts'] = array_values($_SESSION['blog_posts']); // Re-index the array
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Add Task</title>
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- Include CSS styling here -->
    <script>
    function deleteTask(index) {
        var confirmation = confirm("Are you sure you want to delete this task?");
        if (confirmation) {
            window.location.href = "index.php?delete=" + index;
        }
    }
    </script>
</head>
<body>
    <?php require_once 'header.php';?>

    <div class="container">
        <h2>Add Task</h2>
        <form method="post" action="insert_post.php">
            <label for="title">Title:</label><br>
            <input type="text" id="title" name="title" required><br>
            <label for="content">Content:</label><br>
            <textarea id="content" name="content" rows="5" required></textarea><br>
            <input type="submit" value="Add Task">
        </form>
    </div>
    <?php foreach ($posts as $post): ?>
            <div class="task-box">
                <h3><?php echo htmlspecialchars($post['title']); ?></h3>
                <p><?php echo htmlspecialchars($post['content']); ?></p>
                <button class='delete-button' onclick='deleteTask($index)'>Delete</button>

            </div>
        <?php endforeach; ?>
    <?php require_once 'footer.php';?>

</body>
</html>
